import{o as l,c as p,r as i,a as Y,M as P,d as x,b as f,e as Z,f as ee,g as E,h as m,i as u,w as a,u as d,I as F,j as R,k as N,p as te,l as ne,n as se,t as k,m as oe,q as I,F as $,s as H,v as re,x as ue,y as ae,z as ie,A as ce,B as le,C as _e,D as de,E as me,G as pe}from"./vendor.a5f331e9.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const y=(e,n)=>{const t=e.__vccOpts||e;for(const[r,s]of n)t[r]=s;return t},fe={};function he(e,n){const t=i("router-view");return l(),p(t)}const Ee=y(fe,[["render",he]]),ve="modulepreload",ge=function(e){return"/"+e},V={},L=function(n,t,r){return!t||t.length===0?n():Promise.all(t.map(s=>{if(s=ge(s),s in V)return;V[s]=!0;const o=s.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${c}`))return;const _=document.createElement("link");if(_.rel=o?"stylesheet":ve,o||(_.as="script",_.crossOrigin=""),_.href=s,document.head.appendChild(_),o)return new Promise((g,h)=>{_.addEventListener("load",g),_.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>n())},ye={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}.VITE_API_BASE_URL,v=Y.create({baseURL:ye,timeout:6e4}),Be="Bearer ";v.interceptors.request.use(e=>{const n=B();return n.token&&e.headers&&(e.headers.Authorization=Be+n.token),e});v.interceptors.response.use(e=>e.data,async e=>{var t,r,s;const n=(t=e.response)==null?void 0:t.data;return n&&await P.error(n.message),(((r=e.response)==null?void 0:r.status)===401||((s=e.response)==null?void 0:s.status)===403)&&await B().logout(),Promise.reject(e)});const Se=e=>v.post("/tokens",e),be={createToken:Se},we=()=>v.get("/users/me"),Fe=e=>v.get("/users",{params:e}),Re=e=>v.post("/users",e),Ae=(e,n)=>v.post(`/user/${e}`,n),ke={me:we,list:Fe,create:Re,edit:Ae},M=(e,n)=>e.filter(t=>(t.children&&(t.children=M(t.children,n)),!t.meta||t.meta&&(!t.meta.permission||t.meta.permission&&n.includes(t.meta.permission)))),q=e=>{const n=[];return e.forEach(t=>{t.children&&n.push(...q(t.children)),t.name&&n.push(t.name)}),n},O=x("permission",{state:()=>({routes:[]}),persist:!0,actions:{generateRoutes(e,n=!1){this.routes=n?U:M(U,e)}},getters:{menuRoutes(){var e;return(e=this.routes.find(n=>n.name===G))==null?void 0:e.children},permissionRouteNamesList(){return this.routes?q(this.routes):[]}}}),C=x("user",{state:()=>({currentUser:null}),persist:!0,actions:{async fetchCurrentUser(){this.currentUser=await ke.me(),O().generateRoutes(this.currentUser.permissions)}}}),B=x("app",{state:()=>({token:"",menuCollapse:!1}),persist:!0,actions:{async login(e){this.token=await be.createToken(e)},async logout(){const e=C();this.token="",e.$reset()}}}),Ce=e=>(te("data-v-61ea4e79"),e=e(),ne(),e),De={class:"login-container"},Le={class:"content"},$e=Ce(()=>m("h1",null,"Vue3-Admin",-1)),Ue=R("\u767B\u5F55 "),xe=f({__name:"index",setup(e){const n={username:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D"}],password:[{required:!0,message:"\u8BF7\u586B\u5199\u5BC6\u7801"}]},t=Z({username:"",password:""}),r=B(),s=C(),o=ee(!1),c=N(),_=async({validateResult:g})=>{if(g===!0){o.value=!0;try{await r.login(t),await s.fetchCurrentUser(),await P.success("\u767B\u5F55\u6210\u529F"),await c.push({name:"dashboard"})}finally{o.value=!1}}};return(g,h)=>{const A=i("t-input"),b=i("t-form-item"),J=i("t-button"),Q=i("t-form"),X=i("t-card");return l(),E("div",De,[m("div",Le,[u(X,null,{default:a(()=>[$e,u(Q,{ref:"form",data:t,rules:n,class:"login-form",colon:!0,"label-width":0,onSubmit:_},{default:a(()=>[u(b,{name:"username"},{default:a(()=>[u(A,{modelValue:t.username,"onUpdate:modelValue":h[0]||(h[0]=D=>t.username=D),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},{"prefix-icon":a(()=>[u(d(F),{name:"desktop"})]),_:1},8,["modelValue"])]),_:1}),u(b,{name:"password"},{default:a(()=>[u(A,{modelValue:t.password,"onUpdate:modelValue":h[1]||(h[1]=D=>t.password=D),type:"password",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},{"prefix-icon":a(()=>[u(d(F),{name:"lock-on"})]),_:1},8,["modelValue"])]),_:1}),u(b,{style:{"padding-top":"8px"}},{default:a(()=>[u(J,{theme:"primary",type:"submit",block:"",loading:o.value},{default:a(()=>[Ue]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1})])])}}});const Oe=y(xe,[["__scopeId","data-v-61ea4e79"]]),Ie=f({__name:"CollapseButton",props:{collapse:{type:Boolean,required:!0}},emits:["update:collapse"],setup(e){return(n,t)=>(l(),E("div",{class:se(["collapse-button",{collapse:!e.collapse}]),onClick:t[0]||(t[0]=r=>n.$emit("update:collapse",!e.collapse))},null,2))}});const Ve=y(Ie,[["__scopeId","data-v-b5a1452f"]]),Te={class:"operation-area"},Pe=f({__name:"header",setup(e){const n=C(),t=B(),r=N(),s=oe(),o=async({value:c})=>{switch(c){case"logout":await t.logout(),await r.push(`login?redirect=${s.fullPath}`);break;default:throw new Error("\u8BE5\u6307\u4EE4\u65E0\u8BBE\u7F6E\u4EFB\u4F55\u64CD\u4F5C")}};return(c,_)=>{const g=i("t-button"),h=i("t-dropdown"),A=i("t-header");return l(),p(A,{class:"header"},{default:a(()=>[u(Ve,{collapse:d(t).menuCollapse,"onUpdate:collapse":_[0]||(_[0]=b=>d(t).menuCollapse=b)},null,8,["collapse"]),m("div",Te,[u(h,{options:[{content:"\u9000\u51FA\u767B\u5F55",value:"logout"}],"max-column-width":120,onClick:o},{default:a(()=>[u(g,{variant:"text",theme:"default"},{icon:a(()=>[u(d(F),{name:"user"})]),default:a(()=>[R(" "+k(d(n).currentUser&&d(n).currentUser.nickname),1)]),_:1})]),_:1})])]),_:1})}}});const Ne=y(Pe,[["__scopeId","data-v-77b3ef8c"]]),He=f({__name:"SidebarItem",props:{item:{type:Object,default:null}},setup(e){return(n,t)=>{const r=i("t-menu-item"),s=i("sidebar-item",!0),o=i("t-submenu");return l(),E($,null,[e.item&&!e.item.children?(l(),p(r,{key:0,value:e.item.name,to:{name:e.item.name}},{icon:a(()=>[u(d(F),{name:e.item.meta.icon},null,8,["name"])]),default:a(()=>[R(" "+k(e.item.meta.title),1)]),_:1},8,["value","to"])):I("",!0),e.item&&e.item.children?(l(),p(o,{key:1,value:e.item.name,title:e.item.meta.title},{icon:a(()=>[u(d(F),{name:e.item.meta.icon},null,8,["name"])]),default:a(()=>[(l(!0),E($,null,H(e.item.children,c=>(l(),p(s,{key:c.name,item:c},null,8,["item"]))),128))]),_:1},8,["value","title"])):I("",!0)],64)}}}),Me=f({__name:"sidebar",setup(e){const n=B(),t=O();return(r,s)=>{const o=i("t-menu"),c=i("t-aside");return l(),p(c,{width:d(n).menuCollapse?"64px":"232px"},{default:a(()=>[u(o,{collapsed:d(n).menuCollapse,defaultValue:r.$route.name},{default:a(()=>[(l(!0),E($,null,H(d(t).menuRoutes,_=>(l(),p(He,{key:_.name,item:_},null,8,["item"]))),128))]),_:1},8,["collapsed","defaultValue"])]),_:1},8,["width"])}}}),qe=R("\u5E95\u90E8\u533A\u57DF"),je=f({__name:"layout",setup(e){return(n,t)=>{const r=i("router-view"),s=i("t-content"),o=i("t-footer"),c=i("t-layout");return l(),E("div",null,[u(c,{class:"main-layout"},{default:a(()=>[u(Me),u(c,null,{default:a(()=>[u(Ne),u(s,{class:"content-layout"},{default:a(()=>[u(r)]),_:1}),u(o,null,{default:a(()=>[qe]),_:1})]),_:1})]),_:1})])}}});const ze=y(je,[["__scopeId","data-v-73370036"]]),Ge={};function We(e,n){const t=i("router-view");return l(),p(t)}const Ke=y(Ge,[["render",We]]),j="/assets/not-found.c2e9c2e1.png",Je={class:"main"},Qe={class:"content"},Xe=m("img",{src:j},null,-1),Ye={class:"info"},Ze={class:"title"},et={class:"description"},tt=R("\u8FD4\u56DE\u9996\u9875"),z=f({__name:"ErrorPage",props:{title:{default:"\u672A\u77E5\u9519\u8BEF"},description:{default:"\u6682\u65F6\u65E0\u6CD5\u627E\u5230\u9519\u8BEF\u539F\u56E0"}},setup(e){return(n,t)=>{const r=i("t-button");return l(),E("div",Je,[m("div",Qe,[re(n.$slots,"image",{},()=>[Xe]),m("div",Ye,[m("div",Ze,k(e.title),1),m("div",et,k(e.description),1),u(r,{onClick:t[0]||(t[0]=s=>n.$router.replace({path:"/"}))},{default:a(()=>[tt]),_:1})])])])}}});const nt=m("img",{src:j},null,-1),st=f({__name:"not-found",setup(e){return(n,t)=>(l(),p(z,{title:"404\u65E0\u6CD5\u627E\u5230\u8BE5\u9875\u9762",description:`\u62B1\u6B49\u60A8\u8BBF\u95EE\u7684\u9875\u9762\u4E0D\u5B58\u5728
`},{image:a(()=>[nt]),_:1}))}}),ot="/assets/not-allowed.95b00d4e.png",rt=m("img",{src:ot},null,-1),ut=f({__name:"not-allowed",setup(e){return(n,t)=>(l(),p(z,{title:"403\u65E0\u6743\u8BBF\u95EE",description:"\u60A8\u5F53\u524D\u65E0\u6743\u8BBF\u95EE\u8BE5\u9875\u9762\uFF0C\u82E5\u6709\u7591\u95EE\u8BF7\u8DDF\u7F51\u7AD9\u7BA1\u7406\u5458\u8054\u7CFB"},{image:a(()=>[rt]),_:1}))}});var w=(e=>(e.DASHBOARD="dashboard",e.USER="user",e.USER_LIST="user:list",e.USER_LIST_CREATE="user:list:create",e.USER_LIST_EDIT="user:list:edit",e.USER_ROLES="user:roles",e.USER_ROLES_CREATE="user:roles:create",e.USER_ROLES_EDIT="user:roles:edit",e))(w||{});const lt=[{label:"\u63A7\u5236\u53F0",value:"dashboard"},{label:"\u7528\u6237",value:"user",children:[{label:"\u7528\u6237\u7BA1\u7406",value:"user:list",children:[{label:"\u7528\u6237\u521B\u5EFA",value:"user:list:create"},{label:"\u7528\u6237\u7F16\u8F91",value:"user:list:edit"}]},{label:"\u89D2\u8272\u7BA1\u7406",value:"user:roles",children:[{label:"\u89D2\u8272\u521B\u5EFA",value:"user:roles:create"},{label:"\u89D2\u8272\u7F16\u8F91",value:"user:roles:edit"}]}]}],G="menuRoot",U=[{path:"/",name:G,component:ze,redirect:"dashboard",children:[{name:"dashboard",path:"dashboard",component:()=>L(()=>import("./index.91e9c001.js"),["assets/index.91e9c001.js","assets/index.993813bf.css","assets/vendor.a5f331e9.js","assets/vendor.4e3880eb.css"]),meta:{permission:w.DASHBOARD,title:"\u63A7\u5236\u53F0",icon:"dashboard"}},{name:"user",path:"user",component:Ke,meta:{title:"\u7528\u6237",icon:"usergroup",permission:w.USER},redirect:{name:"user-list"},children:[{name:"user-list",path:"list",component:()=>L(()=>import("./index.1812f4b3.js"),["assets/index.1812f4b3.js","assets/useEditDialog.be5e24fc.js","assets/vendor.a5f331e9.js","assets/vendor.4e3880eb.css"]),meta:{title:"\u7528\u6237\u7BA1\u7406",icon:"user",permission:w.USER_LIST}},{name:"role-list",path:"roles",component:()=>L(()=>import("./roles.a83d8b15.js"),["assets/roles.a83d8b15.js","assets/useEditDialog.be5e24fc.js","assets/vendor.a5f331e9.js","assets/vendor.4e3880eb.css"]),meta:{title:"\u89D2\u8272\u7BA1\u7406",permission:w.USER_ROLES,icon:"secured"}}]}]},{path:"/login",name:"login",component:Oe},{path:"/403",name:"not-allowed",component:ut},{path:"/:pathMatch(.*)*",name:"not-fount",component:st}],W=ue({history:ae(),strict:!0,routes:U,scrollBehavior:()=>({left:0,top:0})}),T=["login","not-found","not-allowed"];W.beforeEach((e,n,t)=>{const r=B();if(r.token||(T.indexOf(e.name)!==-1?t():t(`/login?redirect=${e.path}`)),r.token&&e.path==="/login"&&t({name:"dashboard"}),e.name){const o=!O().permissionRouteNamesList.includes(e.name);r.token&&o&&T.indexOf(e.name)!==-1&&t({name:"not-allowed"})}t()});const at=e=>{var n;return((n=C().currentUser)==null?void 0:n.permissions.indexOf(e))===-1},it={mounted(e,{value:n}){var t;at(n)&&((t=e.parentNode)==null||t.removeChild(e))}},K=ie();K.use(ce);const S=le(Ee);S.use(W);S.use(_e);S.use(K);S.use(de,{echarts:me,h:pe});S.directive("permission",it);S.mount("#app");export{w as P,y as _,v as i,lt as p,ke as u};
